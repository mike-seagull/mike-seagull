<!doctype html><html lang=en dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>Build and deploy containers to ghcr.io | </title>
<meta name=keywords content="github actions,github container registry,containers,ghcr,zsh,oh-my-zsh,gitpod">
<meta name=description content="Tutorial for build containers using Github Actions and deploying them GitHub Container Registry.">
<meta name=author content>
<link rel=canonical href=https://blog.hllstr.com/2022/01/17/>
<link crossorigin=anonymous href=/assets/css/stylesheet.min.c88963fe2d79462000fd0fb1b3737783c32855d340583e4523343f8735c787f0.css integrity="sha256-yIlj/i15RiAA/Q+xs3N3g8MoVdNAWD5FIzQ/hzXHh/A=" rel="preload stylesheet" as=style>
<script defer crossorigin=anonymous src=/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5+kdJvBz5iKbt6B5PJI=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://blog.hllstr.com/favicon.ico>
<link rel=icon type=image/png sizes=16x16 href=https://blog.hllstr.com/favicon-16x16.png>
<link rel=icon type=image/png sizes=32x32 href=https://blog.hllstr.com/favicon-32x32.png>
<link rel=apple-touch-icon href=https://blog.hllstr.com/apple-touch-icon.png>
<link rel=mask-icon href=https://blog.hllstr.com/safari-pinned-tab.svg>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<meta name=generator content="Hugo 0.92.0">
<noscript>
<style>#theme-toggle,.top-link{display:none}</style>
<style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style>
</noscript><meta property="og:title" content="Build and deploy containers to ghcr.io">
<meta property="og:description" content="Tutorial for build containers using Github Actions and deploying them GitHub Container Registry.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://blog.hllstr.com/2022/01/17/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2022-01-17T04:42:40+00:00">
<meta property="article:modified_time" content="2022-01-17T04:42:40+00:00">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Build and deploy containers to ghcr.io">
<meta name=twitter:description content="Tutorial for build containers using Github Actions and deploying them GitHub Container Registry.">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://blog.hllstr.com/posts/"},{"@type":"ListItem","position":3,"name":"Build and deploy containers to ghcr.io","item":"https://blog.hllstr.com/2022/01/17/"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Build and deploy containers to ghcr.io","name":"Build and deploy containers to ghcr.io","description":"Tutorial for build containers using Github Actions and deploying them GitHub Container Registry.","keywords":["github actions","github container registry","containers","ghcr","zsh","oh-my-zsh","gitpod"],"articleBody":"I’ve been using Gitpod.io as my main coding IDE. The browser-based IDE has a feature for using a custom docker image as a base for your development space.\nI base my containers with zsh and oh-my-zsh preinstalled How to:\n Create a Dockerfile in a repo  FROMgitpod/workspace-full:latestRUN sh -c \"$(wget -O- https://github.com/deluan/zsh-in-docker/releases/download/v1.1.2/zsh-in-docker.sh)\" -- \\  -t fishy \\  -p ubuntu \\  -p git \\  -p npm -p nvm \\  -p pyenv -p pip -p python \\  -p docker -p docker-compose \\  -p golang \\  -p ansible \\  -p terraform \\  -p https://github.com/zsh-users/zsh-autosuggestions \\  -p https://github.com/zsh-users/zsh-completions \\  -a 'export ZSH_AUTOSUGGEST_HIGHLIGHT_STYLE=\"fg=#757575\"'RUN echo \"if [ -t 1 ]; then\"  ~/.bashrcRUN echo \"exec zsh\"  ~/.bashrcRUN echo \"fi\"  ~/.bashrcThere’s a cool project out there for installing zsh and oh-my-zsh in docker. I added all of the oh-my-zsh plugins I might use with the -p option.\nCreate a GitHub Action workflow  name: base docker image on: push: branches: [\"master\"] jobs: gitpod-base: runs-on: ubuntu-latest permissions: contents: read packages: write steps: - name: Checkout repository uses: actions/checkout@v2 - name: Log in to the Container registry uses: docker/login-action@f054a8b539a109f9f41c372932f1ae047eff08c9 with: registry: ghcr.io username: ${{ github.actor }} password: ${{ secrets.GITHUB_TOKEN }} - name: Extract metadata (tags, labels) for Docker id: meta uses: docker/metadata-action@98669ae865ea3cffbcbaa878cf57c20bbf1c6c38 with: images: ghcr.io/${{ github.repository_owner }}/gitpod-images - name: Build and push Docker image uses: docker/build-push-action@ad44023a93711e3deb337508980b4b5e9bcdc5dc with: context: . file: base.Dockerfile push: true tags: ghcr.io/${{ github.repository_owner }}/gitpod-images:base labels: ${{ steps.meta.outputs.labels }} This workflow will build the container on a push of the main branch. The container will be stored as ghcr.io/${GITHUB_USERNAME}/gitpod-images:base.\nUse the image in Gitpod Using the image is pretty straight-forward. Gitpod allows you to create a config file (.gitpod.yml) in your repo.  github: prebuilds: master: true branches: true image: file: ghcr.io/mike-seagull/gitpod-images:base All of the code is available in my Github repo.\n","wordCount":"294","inLanguage":"en","datePublished":"2022-01-17T04:42:40Z","dateModified":"2022-01-17T04:42:40Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.hllstr.com/2022/01/17/"},"publisher":{"@type":"Organization","name":"","logo":{"@type":"ImageObject","url":"https://blog.hllstr.com/favicon.ico"}}}</script>
</head>
<body id=top>
<script>window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script>
<header class=header>
<nav class=nav>
<div class=logo>
<span class=logo-switches>
</span>
</div>
<ul id=menu>
</ul>
</nav>
</header>
<main class=main>
<article class=post-single>
<header class=post-header>
<div class=breadcrumbs><a href=https://blog.hllstr.com>Home</a>&nbsp;»&nbsp;<a href=https://blog.hllstr.com/posts/>Posts</a></div>
<h1 class=post-title>
Build and deploy containers to ghcr.io
</h1>
</header>
<div class=post-content><p>I&rsquo;ve been using <a href=https://gitpod.io>Gitpod.io</a> as my main coding IDE. The browser-based IDE has a <a href=https://www.gitpod.io/docs/config-docker>feature for using a custom docker image</a> as a base for your development space.</p>
<p>I base my containers with zsh and oh-my-zsh preinstalled
How to:</p>
<ol>
<li>Create a Dockerfile in a repo</li>
</ol>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dockerfile data-lang=dockerfile><span style=color:#66d9ef>FROM</span><span style=color:#e6db74> gitpod/workspace-full:latest</span><span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> sh -c <span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>wget -O- https://github.com/deluan/zsh-in-docker/releases/download/v1.1.2/zsh-in-docker.sh<span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span> -- <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>    -t fishy <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>    -p ubuntu <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>    -p git <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>    -p npm -p nvm <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>    -p pyenv -p pip -p python <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>    -p docker -p docker-compose <span style=color:#ae81ff>\ </span><span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span>    -p golang <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>    -p ansible <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>    -p terraform <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>    -p https://github.com/zsh-users/zsh-autosuggestions <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>    -p https://github.com/zsh-users/zsh-completions <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>    -a <span style=color:#e6db74>&#39;export ZSH_AUTOSUGGEST_HIGHLIGHT_STYLE=&#34;fg=#757575&#34;&#39;</span><span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> echo <span style=color:#e6db74>&#34;if [ -t 1 ]; then&#34;</span> &gt;&gt; ~/.bashrc<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> echo <span style=color:#e6db74>&#34;exec zsh&#34;</span> &gt;&gt; ~/.bashrc<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> echo <span style=color:#e6db74>&#34;fi&#34;</span> &gt;&gt; ~/.bashrc<span style=color:#960050;background-color:#1e0010>
</span></code></pre></div><p>There&rsquo;s a cool <a href=https://github.com/deluan/zsh-in-docker>project out there for installing zsh and oh-my-zsh in docker</a>. I added all of the oh-my-zsh plugins I might use with the <code>-p</code> option.</p>
<ol start=2>
<li>Create a GitHub Action workflow</li>
</ol>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>name</span>: <span style=color:#ae81ff>base docker image</span>

<span style=color:#f92672>on</span>:
  <span style=color:#f92672>push</span>:
    <span style=color:#f92672>branches</span>: [<span style=color:#e6db74>&#34;master&#34;</span>]

<span style=color:#f92672>jobs</span>:
  <span style=color:#f92672>gitpod-base</span>:
    <span style=color:#f92672>runs-on</span>: <span style=color:#ae81ff>ubuntu-latest</span>
    <span style=color:#f92672>permissions</span>:
      <span style=color:#f92672>contents</span>: <span style=color:#ae81ff>read</span>
      <span style=color:#f92672>packages</span>: <span style=color:#ae81ff>write</span>

    <span style=color:#f92672>steps</span>:
      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Checkout repository</span>
        <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>actions/checkout@v2</span>

      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Log in to the Container registry</span>
        <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>docker/login-action@f054a8b539a109f9f41c372932f1ae047eff08c9</span>
        <span style=color:#f92672>with</span>:
          <span style=color:#f92672>registry</span>: <span style=color:#ae81ff>ghcr.io</span>
          <span style=color:#f92672>username</span>: <span style=color:#ae81ff>${{ github.actor }}</span>
          <span style=color:#f92672>password</span>: <span style=color:#ae81ff>${{ secrets.GITHUB_TOKEN }}</span>

      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Extract metadata (tags, labels) for Docker</span>
        <span style=color:#f92672>id</span>: <span style=color:#ae81ff>meta</span>
        <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>docker/metadata-action@98669ae865ea3cffbcbaa878cf57c20bbf1c6c38</span>
        <span style=color:#f92672>with</span>:
          <span style=color:#f92672>images</span>: <span style=color:#ae81ff>ghcr.io/${{ github.repository_owner }}/gitpod-images</span>

      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Build and push Docker image</span>
        <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>docker/build-push-action@ad44023a93711e3deb337508980b4b5e9bcdc5dc</span>
        <span style=color:#f92672>with</span>:
          <span style=color:#f92672>context</span>: <span style=color:#ae81ff>.</span>
          <span style=color:#f92672>file</span>: <span style=color:#ae81ff>base.Dockerfile</span>
          <span style=color:#f92672>push</span>: <span style=color:#66d9ef>true</span>
          <span style=color:#f92672>tags</span>: <span style=color:#ae81ff>ghcr.io/${{ github.repository_owner }}/gitpod-images:base</span>
          <span style=color:#f92672>labels</span>: <span style=color:#ae81ff>${{ steps.meta.outputs.labels }}</span>
</code></pre></div><p>This workflow will build the container on a push of the main branch. The container will be stored as <code>ghcr.io/${GITHUB_USERNAME}/gitpod-images:base</code>.</p>
<ol start=3>
<li>Use the image in Gitpod
Using the image is pretty straight-forward. Gitpod allows you to create a <a href=https://www.gitpod.io/docs/config-gitpod-file>config file (.gitpod.yml)</a> in your repo.</li>
</ol>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>github</span>:
  <span style=color:#f92672>prebuilds</span>:
    <span style=color:#f92672>master</span>: <span style=color:#66d9ef>true</span>
    <span style=color:#f92672>branches</span>: <span style=color:#66d9ef>true</span>
<span style=color:#f92672>image</span>:
  <span style=color:#f92672>file</span>: <span style=color:#ae81ff>ghcr.io/mike-seagull/gitpod-images:base</span>
</code></pre></div><p>All of the code is available in <a href=https://github.com/mike-seagull/mike-seagull.github.io>my Github repo</a>.</p>
</div>
<footer class=post-footer>
</footer>
</article>
</main>
<footer class=footer>
<span>&copy; 2022 <a href=https://blog.hllstr.com></a></span>
<span>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a>
</span>
</footer>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a>
<script>let menu=document.getElementById('menu');menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
<script>document.querySelectorAll('pre > code').forEach(b=>{const c=b.parentNode.parentNode,a=document.createElement('button');a.classList.add('copy-code'),a.innerText='copy';function d(){a.innerText='copied!',setTimeout(()=>{a.innerText='copy'},2e3)}a.addEventListener('click',e=>{if('clipboard'in navigator){navigator.clipboard.writeText(b.textContent),d();return}const a=document.createRange();a.selectNodeContents(b);const c=window.getSelection();c.removeAllRanges(),c.addRange(a);try{document.execCommand('copy'),d()}catch(a){}c.removeRange(a)}),c.classList.contains("highlight")?c.appendChild(a):c.parentNode.firstChild==c||(b.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?b.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(a):b.parentNode.appendChild(a))})</script>
</body>
</html>